<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lunch Veto Tracker</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, sans-serif; background: #f5f5f5; min-height: 100vh; }
        .screen { min-height: 100vh; }
        .hidden { display: none !important; }
        
        /* Login */
        .login-container {
            display: flex; align-items: center; justify-content: center;
            min-height: 100vh; padding: 20px;
        }
        .login-box {
            background: white; padding: 40px; border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1); width: 100%; max-width: 400px;
        }
        .login-box h1 { text-align: center; margin-bottom: 8px; }
        .login-box p { text-align: center; color: #666; margin-bottom: 24px; }
        .login-box input {
            width: 100%; padding: 14px; border: 2px solid #ddd;
            border-radius: 8px; font-size: 16px; margin-bottom: 12px;
        }
        .login-box button {
            width: 100%; padding: 14px; background: #667eea;
            color: white; border: none; border-radius: 8px;
            font-size: 18px; cursor: pointer;
        }
        .login-box button:hover { background: #5a6fd6; }
        
        /* Main App */
        header {
            background: white; padding: 16px; display: flex;
            justify-content: space-between; align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        header h1 { font-size: 18px; }
        .user-tag { background: #667eea; color: white; padding: 6px 14px; border-radius: 20px; }
        
        nav { display: flex; background: white; border-bottom: 1px solid #eee; }
        nav button {
            flex: 1; padding: 14px; border: none; background: none;
            font-size: 16px; cursor: pointer; color: #666;
        }
        nav button.active { color: #667eea; border-bottom: 3px solid #667eea; }
        
        .content { padding: 20px; max-width: 600px; margin: 0 auto; }
        
        /* Dashboard */
        .round-card {
            background: white; padding: 24px; border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center; margin-bottom: 20px;
        }
        .round-card h2 { color: #666; font-size: 14px; text-transform: uppercase; }
        .picker-name { font-size: 28px; font-weight: bold; color: #667eea; margin: 16px 0; }
        .instruction { color: #888; margin-bottom: 20px; }
        
        .phase-card {
            background: white; padding: 24px; border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px;
        }
        .phase-card h3 { margin-bottom: 16px; }
        .restaurant-row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 14px; background: #f8f9fa; border-radius: 8px; margin-bottom: 8px;
        }
        .phase-card button {
            width: 100%; padding: 14px; background: #667eea;
            color: white; border: none; border-radius: 8px;
            font-size: 16px; cursor: pointer; margin-top: 16px;
        }
        .phase-card button:disabled { background: #ccc; cursor: not-allowed; }
        
        /* Restaurants Tab */
        .add-row { display: flex; gap: 10px; margin-bottom: 20px; }
        .add-row input { flex: 1; padding: 12px; border: 2px solid #ddd; border-radius: 8px; }
        .add-row button { padding: 12px 24px; background: #27ae60; color: white; border: none; border-radius: 8px; cursor: pointer; }
        .restaurant-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 14px; background: white; border-radius: 8px;
            margin-bottom: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .delete-btn { color: #e74c3c; cursor: pointer; padding: 5px 10px; }
        
        /* Winner */
        .winner-banner {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            padding: 40px; border-radius: 12px; text-align: center; color: white;
        }
        .winner-banner h3 { font-size: 24px; margin-bottom: 16px; }
        .winner-name { font-size: 36px; font-weight: bold; margin-bottom: 20px; }
        .winner-banner button {
            background: white; color: #f5576c; border: none;
            padding: 14px 28px; border-radius: 8px; font-size: 16px; cursor: pointer;
        }
        
        /* History */
        .history-item {
            background: white; padding: 16px; border-radius: 8px;
            margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .history-date { color: #888; font-size: 13px; }
        .history-winner { font-size: 20px; font-weight: bold; color: #27ae60; margin: 8px 0; }
        .history-picker { color: #666; }
        
        /* Utility */
        .nav-buttons { display: flex; gap: 10px; }
        .logout-btn { background: #f0f0f0; color: #666; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="login-screen" class="screen login-container">
        <div class="login-box">
            <h1>üçï Lunch Tracker</h1>
            <p>Enter your name and password</p>
            <input type="text" id="username" placeholder="Your name (Craig, Seth, or Chris)">
            <input type="password" id="password" placeholder="Password">
            <button onclick="doLogin()">Join</button>
            <p id="login-error" style="color: #e74c3c; text-align: center; margin-top: 12px;"></p>
        </div>
    </div>
    
    <!-- Main Screen -->
    <div id="main-screen" class="screen hidden">
        <header>
            <h1>üçï Lunch Tracker</h1>
            <div class="nav-buttons">
                <span id="current-user" class="user-tag"></span>
                <button class="logout-btn" onclick="doLogout()">Logout</button>
            </div>
        </header>
        
        <nav>
            <button id="nav-dash" class="active" onclick="showTab('dashboard')">Dashboard</button>
            <button id="nav-rest" onclick="showTab('restaurants')">Restaurants</button>
            <button id="nav-hist" onclick="showTab('history')">History</button>
        </nav>
        
        <!-- Dashboard Tab -->
        <div id="tab-dashboard" class="content">
            <div class="round-card">
                <h2>Current Round</h2>
                <div id="picker-display" class="picker-name"></div>
                <p id="round-instruction" class="instruction"></p>
            </div>
            
            <div id="phase-suggestion" class="phase-card hidden">
                <h3>Pick 3 Restaurants</h3>
                <div id="suggestions-list"></div>
                <button id="start-veto-btn" onclick="startVeto()" disabled>Start Veto Phase</button>
            </div>
            
            <div id="phase-veto" class="phase-card hidden">
                <h3>Tap to Veto</h3>
                <div id="veto-list"></div>
                <button id="complete-veto-btn" onclick="completeVeto()" class="hidden">Pick Winner</button>
            </div>
            
            <div id="phase-winner" class="winner-banner hidden">
                <h3>üéâ Winner!</h3>
                <div id="winner-display" class="winner-name"></div>
                <button onclick="startNewRound()">Start New Round</button>
            </div>
        </div>
        
        <!-- Restaurants Tab -->
        <div id="tab-restaurants" class="content hidden">
            <div class="add-row">
                <input type="text" id="new-restaurant" placeholder="Add new restaurant">
                <button onclick="addRestaurant()">Add</button>
            </div>
            <div id="restaurant-list"></div>
        </div>
        
        <!-- History Tab -->
        <div id="tab-history" class="content hidden">
            <div id="history-list"></div>
        </div>
    </div>

    <script>
        // Configuration
        const PASSWORD = 'doug_rocks';
        const USERS = ['craig', 'seth', 'chris'];
        const USERNAMES = ['Craig', 'Seth', 'Chris'];
        
        let currentUser = null;
        let currentRound = null;
        
        // Initialize
        function init() {
            const saved = localStorage.getItem('lunchUser');
            if (saved) {
                currentUser = saved;
                showMain();
                loadRound();
            }
        }
        
        // Login
        function doLogin() {
            const name = document.getElementById('username').value.trim().toLowerCase();
            const password = document.getElementById('password').value;
            
            if (!name || !password) {
                document.getElementById('login-error').textContent = 'Fill in both fields';
                return;
            }
            
            if (password !== PASSWORD) {
                document.getElementById('login-error').textContent = 'Wrong password';
                return;
            }
            
            if (!USERS.includes(name)) {
                document.getElementById('login-error').textContent = 'Use Craig, Seth, or Chris';
                return;
            }
            
            currentUser = name;
            localStorage.setItem('lunchUser', name);
            showMain();
            loadRound();
        }
        
        function doLogout() {
            currentUser = null;
            localStorage.removeItem('lunchUser');
            document.getElementById('main-screen').classList.add('hidden');
            document.getElementById('login-screen').classList.remove('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }
        
        // Show main screen
        function showMain() {
            const displayName = USERNAMES[USERS.indexOf(currentUser)];
            document.getElementById('current-user').textContent = displayName;
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('main-screen').classList.remove('hidden');
        }
        
        // Tab navigation
        function showTab(tab) {
            document.querySelectorAll('.content > div').forEach(d => d.classList.add('hidden'));
            document.getElementById('tab-' + tab).classList.remove('hidden');
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
            document.getElementById('nav-' + tab.substring(0,4)).classList.add('active');
            
            if (tab === 'restaurants') loadRestaurants();
            if (tab === 'history') loadHistory();
        }
        
        // Round Management
        function loadRound() {
            const saved = localStorage.getItem('lunchRound');
            currentRound = saved ? JSON.parse(saved) : null;
            updateRoundDisplay();
        }
        
        function startNewRound() {
            const history = JSON.parse(localStorage.getItem('lunchHistory') || '[]');
            let lastPicker = history.length > 0 ? history[0].picker : 'chris';
            let idx = USERS.indexOf(lastPicker);
            let nextPicker = USERS[(idx + 1) % USERS.length];
            
            currentRound = {
                picker: nextPicker,
                phase: 'suggestion',
                suggestions: [],
                vetos: {}
            };
            saveRound();
            updateRoundDisplay();
        }
        
        function saveRound() {
            localStorage.setItem('lunchRound', JSON.stringify(currentRound));
        }
        
        function updateRoundDisplay() {
            const pickerName = USERNAMES[USERS.indexOf(currentRound?.picker)] || 'Nobody';
            const isMyTurn = currentUser === currentRound?.picker;
            
            document.getElementById('picker-display').textContent = 
                pickerName + (isMyTurn ? ' (You!)' : '');
            
            document.getElementById('round-instruction').textContent = isMyTurn
                ? "It's your turn to pick 3 places!"
                : `Waiting for ${pickerName} to pick...`;
            
            // Hide all phases
            ['suggestion', 'veto', 'winner'].forEach(p => 
                document.getElementById('phase-' + p).classList.add('hidden'));
            
            if (!currentRound) {
                document.getElementById('start-veto-btn').onclick = startNewRound;
                document.getElementById('phase-suggestion').classList.remove('hidden');
                document.getElementById('suggestions-list').innerHTML = 
                    '<p style="text-align:center;color:#888;padding:20px;">No active round</p>';
                document.getElementById('start-veto-btn').textContent = 'Start New Round';
                document.getElementById('start-veto-btn').disabled = false;
                return;
            }
            
            if (currentRound.phase === 'suggestion') {
                renderSuggestions();
            } else if (currentRound.phase === 'veto') {
                renderVetoList();
            } else if (currentRound.phase === 'winner') {
                document.getElementById('winner-display').textContent = currentRound.winner;
                document.getElementById('phase-winner').classList.remove('hidden');
            }
        }
        
        // Suggestion Phase
        function renderSuggestions() {
            const phase = document.getElementById('phase-suggestion');
            phase.classList.remove('hidden');
            const list = document.getElementById('suggestions-list');
            const btn = document.getElementById('start-veto-btn');
            
            const suggestions = currentRound.suggestions || [];
            
            if (suggestions.length === 0) {
                list.innerHTML = isPicker() 
                    ? '<p style="text-align:center;color:#888;">Add restaurants below or type new ones:</p>'
                    : '<p style="text-align:center;color:#888;">Waiting for picker...</p>';
            } else {
                list.innerHTML = suggestions.map((s, i) => 
                    '<div class="restaurant-row"><span>' + (i+1) + '. ' + s + '</span>' +
                    (isPicker() ? '<span class="delete-btn" onclick="removeSuggestion(' + i + ')">‚úï</span>' : '') +
                    '</div>'
                ).join('');
            }
            
            btn.textContent = suggestions.length === 3 
                ? (isPicker() ? 'Start Veto Phase' : 'Waiting...')
                : 'Add more places (' + suggestions.length + '/3)';
            btn.disabled = suggestions.length !== 3;
            if (isPicker()) btn.onclick = startVeto;
        }
        
        function addSuggestion(name) {
            const suggestions = currentRound.suggestions || [];
            if (suggestions.length >= 3) return;
            suggestions.push(name);
            currentRound.suggestions = suggestions;
            saveRound();
            renderSuggestions();
        }
        
        function removeSuggestion(idx) {
            currentRound.suggestions.splice(idx, 1);
            saveRound();
            renderSuggestions();
        }
        
        function isPicker() {
            return currentUser === currentRound?.picker;
        }
        
        function startVeto() {
            currentRound.phase = 'veto';
            currentRound.vetos = {};
            saveRound();
            renderVetoList();
        }
        
        // Veto Phase
        function renderVetoList() {
            const phase = document.getElementById('phase-veto');
            phase.classList.remove('hidden');
            const list = document.getElementById('veto-list');
            const btn = document.getElementById('complete-veto-btn');
            
            const suggestions = currentRound.suggestions || [];
            const vetos = currentRound.vetos || {};
            const vetoed = Object.values(vetos);
            const hasVetoed = Object.keys(vetos).includes(currentUser);
            
            list.innerHTML = suggestions.map(s => {
                const count = vetoed.filter(v => v === s).length;
                const isVetoed = count >= 2;
                const canClick = !isPicker() && !isVetoed && !hasVetoed;
                return '<div class="restaurant-row" onclick="' + (canClick ? "doVeto('" + s.replace(/'/g, "\\'") + "')" : '') + '" style="' + (canClick ? 'cursor:pointer' : '') + '">' +
                    '<span style="' + (isVetoed ? 'text-decoration:line-through;color:#e74c3c' : '') + '">' + s + '</span>' +
                    '<span style="background:' + (isVetoed ? '#e74c3c' : '#667eea') + ';color:white;padding:4px 12px;border-radius:20px;font-size:13px">' +
                    (isVetoed ? '‚ùå Vetoed' : count + '/2 vetos') + '</span></div>';
            }).join('');
            
            // Show complete button if all non-pickers have vetoed
            const nonPickers = USERS.filter(u => u !== currentRound.picker);
            const allVetoed = nonPickers.every(u => Object.keys(vetos).includes(u));
            
            if (allVetoed || isPicker()) {
                btn.classList.remove('hidden');
                btn.disabled = !allVetoed;
                btn.textContent = isPicker() ? 'Pick Winner' : 'Waiting...';
            } else {
                btn.classList.add('hidden');
            }
        }
        
        function doVeto(restaurant) {
            currentRound.vetos[currentUser] = restaurant;
            saveRound();
            renderVetoList();
        }
        
        function completeVeto() {
            const suggestions = currentRound.suggestions || [];
            const vetos = Object.values(currentRound.vetos || {});
            const vetoed = [...new Set(vetos)];
            
            let winner = suggestions.find(s => !vetoed.includes(s));
            if (!winner) winner = USERNAMES[USERS.indexOf(currentRound.picker)]; // Picker wins if all vetoed
            
            // Save to history
            const history = JSON.parse(localStorage.getItem('lunchHistory') || '[]');
            history.unshift({
                date: new Date().toISOString().split('T')[0],
                picker: USERNAMES[USERS.indexOf(currentRound.picker)],
                winner: winner
            });
            localStorage.setItem('lunchHistory', JSON.stringify(history));
            
            currentRound.phase = 'winner';
            currentRound.winner = winner;
            saveRound();
            updateRoundDisplay();
        }
        
        // Restaurants Tab
        function loadRestaurants() {
            const list = document.getElementById('restaurant-list');
            const restaurants = JSON.parse(localStorage.getItem('lunchRestaurants') || '[]');
            
            if (restaurants.length === 0) {
                // Add defaults
                const defaults = ['El Toro', 'Chick-fil-A', 'Panera Bread', 'Texas Roadhouse', 
                                 'Olive Garden', 'Outback', 'Applebee\'s', 'Buffalo Wild Wings'];
                defaults.forEach(r => restaurants.push(r));
                localStorage.setItem('lunchRestaurants', JSON.stringify(restaurants));
            }
            
            list.innerHTML = restaurants.map((r, i) => 
                '<div class="restaurant-item"><span>' + r + '</span>' +
                '<span class="delete-btn" onclick="deleteRestaurant(' + i + ')">‚úï</span></div>'
            ).join('');
        }
        
        function addRestaurant() {
            const input = document.getElementById('new-restaurant');
            const name = input.value.trim();
            if (!name) return;
            
            const restaurants = JSON.parse(localStorage.getItem('lunchRestaurants') || '[]');
            restaurants.push(name);
            localStorage.setItem('lunchRestaurants', JSON.stringify(restaurants));
            input.value = '';
            loadRestaurants();
        }
        
        function deleteRestaurant(idx) {
            const restaurants = JSON.parse(localStorage.getItem('lunchRestaurants') || '[]');
            restaurants.splice(idx, 1);
            localStorage.setItem('lunchRestaurants', JSON.stringify(restaurants));
            loadRestaurants();
        }
        
        // History Tab
        function loadHistory() {
            const list = document.getElementById('history-list');
            const history = JSON.parse(localStorage.getItem('lunchHistory') || '[]');
            
            if (history.length === 0) {
                list.innerHTML = '<p style="text-align:center;color:#888;padding:40px;">No history yet!</p>';
                return;
            }
            
            list.innerHTML = history.map(h => 
                '<div class="history-item"><div class="history-date">' + h.date + '</div>' +
                '<div class="history-winner">üèÜ ' + h.winner + '</div>' +
                '<div class="history-picker">Picker: ' + h.picker + '</div></div>'
            ).join('');
        }
        
        // Start
        init();
    </script>
</body>
</html>
